function zoomed(){projection.translate(zoom.translate()).scale(zoom.scale),svg.selectAll("path").attr("d".path)}var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight,scale0=(x-1)/2/Math.PI,zoom=d3.behavior.zoom().translate([x/2,y/2]).scale(scale0).scaleExtent([scale0,8*scale0]).on("zoom",zoomed),svg=d3.select("body").style("margin","0").append("svg").attr({width:x,height:y}).style("background","#161d54");d3.select(window).on("resize",function(){x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight,svg.attr({width:x,height:y})});var projection=d3.geo.mercator().translate([x/2,y/2]).scale(750).center([30,40]),path=d3.geo.path().projection(projection),tooltip=d3.select("body").append("div").attr("class","hidden tooltip");d3.json("d/world.json",function(t,e){if(t)return console.error(t);var n=topojson.feature(e,e.objects.worldsubunit);svg.selectAll(".country").data(n.features).enter().append("path").attr({"class":function(t){return"country "+t.properties.NAME_LONG},d:path,fill:"#324489"}).call(zoom),d3.json("d/c_death.json",function(t,e){if(t)return console.error(t);console.log(),svg.selectAll(".originPin").data(e).enter().append("circle",".originPin").attr({r:function(t){return Math.sqrt(t.count)},fill:"#5471d6",opacity:function(t){return"NA"!=t.deathLat&&"NA"!=t.originLat?.5:0},transform:function(t){return"translate("+projection([t.originLng,t.originLat])+")"}}),travelPath=[];for(var n=0,o=e.length-1;o>n;n++)travelPath.push({type:"LineString",coordinates:[[e[n].originLng,e[n].originLat],[e[n].deathLng,e[n].deathLat]]});var a=svg.selectAll(".arc").data(travelPath);a.enter().append("path").attr({"class":"arc"}).style({fill:"none"}),a.attr({d:path}).style({stroke:"#697dca","stroke-width":"0.5px",opacity:"0.2"}),a.exit().remove(),svg.selectAll(".deathPin").data(e).enter().append("circle",".originPin").attr({r:function(t){return Math.sqrt(t.count)},fill:"#972b38",stroke:"#FFF","stroke-width":"0.3",opacity:function(t){return"NA"!=t.deathLat&&"NA"!=t.originLat?.7:0},transform:function(t){return"translate("+projection([t.deathLng,t.deathLat])+")"}}).on("mousemove",function(t){var e=d3.mouse(svg.node()).map(function(t){return parseInt(t)});tooltip.classed("hidden",!1).attr("style","left:"+(e[0]+15)+"px; top:"+(e[1]-35)+"px").html('<span style="font-weight: bold"> '+t.date+"</span><br>"+t.count+" people "+t["cause of death"])}).on("mouseout",function(){tooltip.classed("hidden",!0)})})});